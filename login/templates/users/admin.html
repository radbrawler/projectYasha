{% include "users/base.html" %}

<body>
    <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <a href="/home" class="navbar-brand">projectYasha</a>
        </div>
        <div class="collapse navbar-collapse">
            <ul class="nav navbar-nav">
                 <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Notification
                    <span class="badge"> {{ nn }}</span>
                    </a>
                    <ul class="dropdown-menu">
                        {% for notif in notifs %}
                        <li><a href="#" id="{{ notif.id }} ">Assign {{ notif.request.number }}
                            {{ notif.request.r_object }} to {{ notif.request.r_username.name }}  </a></li>
                        <div align="center">
                            <button class="btn btn-primary" type="button"
                                   id="app{{ notif.id }}" onclick="app{{ notif.id }}()">Assign</button>
                        </div>
                        {% endfor %}

                    </ul>
                 </li>
             </ul>
            <ul class="nav navbar-nav navbar-right">
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                        <span class="glyphicon glyphicon-user"></span>
                        <strong>{{user.name}}</strong>
                        <span class="glyphicon glyphicon-chevron-down"></span>
                    </a>
                    <ul class="dropdown-menu">
                        <li>
                            <div class="navbar-login">
                                <div class="row">
                                    <div class="col-lg-4">
                                        <p class="text-center">
                                            <span class="glyphicon glyphicon-user icon-size"></span>
                                        </p>
                                    </div>
                                    <div class="col-lg-8">
                                        <p class="text-left"><strong>{{user.name}}</strong></p>
                                        <p class="text-left small">{{ user.email }}</p>
                                        <p class="text-left">
                                            <a href="/login/logout" class="btn btn-primary btn-block btn-sm">Logout</a>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </li>
                        <li class="divider"></li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
    </nav>

    <br><br><br><br>
    {% if msg %}
    <div class="alert alert-success fade in">
        <a href="#" class="close" data-dismiss="alert">&times;</a>
        <strong>Success!</strong> {{ msg }}
    </div>
    {% endif %}


    <div class="container-fluid">
        <div class="row-fluid">
            <div class="col-md-2">
				<ul class="nav nav-pills nav-stacked">
				  <li><a href=#>Purchase Request</a></li>
				  <li><a href="/login/logout">Logout</a></li>
				</ul>
			</div>
			<div class="col-md-10">
    			<h2>Object Details</h2>
    			<table class="table table-striped table-hover ">
            	    <thead>
                          <tr>
                              <th>#</th>
                              <th>Name</th>
                              <th>Cost</th>
                              <th>Due Date</th>
                          </tr>
            	    </thead>
            	    <tbody>
                        {% for object in obj %}
                        <tr></tr>
                            <td>1</td>
                            <td>{{object.name}}</a></td>
                            <td>{{object.cost}}</td>
                            <!--<td>{{object.currentOwner}}</td>-->
                            <td>{{object.dueDate}}</td>
                        </tr>
                        {% endfor %}
            	    </tbody>
            	 </table>
    		</div>

        </div>
    </div>

</body>

<script>
{% for message in msg %}
$(document).ready(function() {
    $.pnotify({
        title: '{{ message.tags|upper }}',
        text: '{{ message }}.',
        type: '{{ message.tags }}',
        hide: false,
        styling: 'bootstrap',
        closer_hover: false,
        sticker_hover: false
    });
});
{% endfor %}

function sleep(miliseconds) {
   var currentTime = new Date().getTime();

   while (currentTime + miliseconds >= new Date().getTime()) {
   }
}

function getCookie(name) {
        var cookieValue = null;
        if (document.cookie && document.cookie != '') {
            var cookies = document.cookie.split(';');
            for (var i = 0; i < cookies.length; i++) {
                var cookie = jQuery.trim(cookies[i]);
                // Does this cookie string begin with the name we want?
                if (cookie.substring(0, name.length + 1) == (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

{% for notif in notifs %}
function app{{notif.id}}() {
    var csrftoken = getCookie("csrftoken");
    $.post("/login/ass_obj",
        {
            csrfmiddlewaretoken: csrftoken,
            req: "app",
            id: "{{notif.id}}"
        });
        sleep(2000);
    window.location.href = '/login/index';
}

function rej{{notif.id}}() {
    var csrftoken = getCookie("csrftoken");
    $.post("/login/approve",
        {
            csrfmiddlewaretoken: csrftoken,
            req: "rej",
            id: "{{notif.id}}"
        });
        sleep(2);
    window.location.href = '/login/index';
}
{% endfor %}
</script>